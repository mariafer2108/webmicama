<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carrito — Mi Cama Hogar</title>
    <link rel="stylesheet" href="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Nunito:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=EB+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="brandbar">
            <div class="container brand-wrap">
                <img class="logo-img" src="img/logo.jpg" alt="Mi Cama Hogar" />
            </div>
        </div>
        <div class="topbar">
            <div class="container nav-wrap">
                <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-label="Abrir menú">
                <label for="nav-toggle" class="hamburger" aria-label="Abrir menú"><span></span><span></span><span></span></label>
                <nav class="nav">
                    <a href="index.html">Inicio</a>
                    <a href="productos.html">Productos</a>
                    <a href="carrito.html"><i class="fa-solid fa-cart-shopping"></i> Carrito</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container cart">
        <h1 class="page-title">Tu Carrito</h1>

        <!-- Estado vacío -->
        <div class="cart-empty">
            <i class="fa-solid fa-cart-shopping" style="font-size:42px;color:#7eaed0;"></i>
            <p>Tu carrito está vacío.</p>
            <a class="btn btn-primary" href="productos.html">Explorar productos</a>
        </div>

        <!-- Tabla (preparada para cuando haya items; ocúltala si está vacío) -->
        <table class="cart-table" aria-label="Tabla de carrito" style="display:none;">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Total</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Dentro de .cart-actions -->
        <div class="cart-actions" style="display:none;">
            <div class="totals"></div>
            <a class="btn btn-outline" href="productos.html">Continuar comprando</a>
            <a class="btn btn-primary" href="checkout.html">Finalizar compra</a>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-grid">
            <div class="contact">
                <h4>Contáctanos</h4>
                <p><i class="fa-brands fa-whatsapp"></i> +56959288588</p>
                <p>Vicente Reyes 773</p>
            </div>
            <div class="social">
                <h4>Social</h4>
                <div class="icons">
                    <a href="https://www.facebook.com/profile.php?id=100023850053500" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-facebook-square"></i>
                    </a>
                    <a href="https://www.instagram.com/micama_villarrica/" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-instagram"></i>
                    </a>
                </div>
            </div>
            <div class="copy">
                <p>Copyright © 2025 Diseñado por Maria Fernanda Freelancer</p>
            </div>
        </div>
    </footer>
</body>
</html>
<script src="cart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const emptyBox = document.querySelector('.cart-empty');
  const table = document.querySelector('.cart-table');
  const tbody = table.querySelector('tbody');
  const actions = document.querySelector('.cart-actions');
  const totalsEl = actions.querySelector('.totals');

  function render() {
    const cart = Cart.getCart();
    if (!cart.length) {
      emptyBox.style.display = '';
      table.style.display = 'none';
      actions.style.display = 'none';
      tbody.innerHTML = '';
      totalsEl.textContent = '';
      return;
    }

    emptyBox.style.display = 'none';
    table.style.display = '';
    actions.style.display = '';

    tbody.innerHTML = cart.map((it) => {
      const total = it.price * it.qty;
      const href = `producto.html?key=${encodeURIComponent(it.key)}&name=${encodeURIComponent(it.name)}&measure=${encodeURIComponent(it.measure || '')}`;
      return `
        <tr data-key="${it.key}">
          <td>
            <div style="display:flex;gap:8px;align-items:center;">
              <a href="${href}" aria-label="Ver ${it.name}">
                <img src="${it.image}" alt="${it.name}" style="width:56px;height:56px;object-fit:cover;border-radius:6px;">
              </a>
              <div>
                <div><strong>${it.name}</strong></div>
                <div style="font-size:0.85rem;color:#666;">${it.category}${it.measure ? ' • ' + it.measure : ''}</div>
              </div>
            </div>
          </td>
          <td>
            <input type="number" min="1" max="99" value="${it.qty}" class="qty-input" style="width:64px;">
          </td>
          <td>${Cart.formatCLP(it.price)}</td>
          <td>${Cart.formatCLP(total)}</td>
          <td><button class="btn btn-outline" data-remove>Eliminar</button></td>
        </tr>
      `;
    }).join('');

    const { subtotal, count } = Cart.totals(cart);
    totalsEl.textContent = `Items: ${count} • Subtotal: ${Cart.formatCLP(subtotal)}`;
  }

  tbody.addEventListener('input', (ev) => {
    const row = ev.target.closest('tr');
    if (!row) return;
    if (ev.target.matches('.qty-input')) {
      Cart.updateQty(row.dataset.key, ev.target.value);
      render();
    }
  });

  tbody.addEventListener('click', (ev) => {
    const row = ev.target.closest('tr');
    if (!row) return;
    if (ev.target.matches('[data-remove]')) {
      Cart.removeFromCart(row.dataset.key);
      render();
    }
  });

  render();
});
</script>