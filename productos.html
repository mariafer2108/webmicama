<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Productos — Mi Cama Hogar</title>
    <link rel="stylesheet" href="styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Nunito:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=EB+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="brandbar">
            <div class="container brand-wrap">
                <img class="logo-img" src="img/logo.jpg" alt="Mi Cama Hogar" />
            </div>
        </div>
        <div class="topbar"><div class="container nav-wrap"><input type="checkbox" id="nav-toggle" class="nav-toggle" aria-label="Abrir menú"><label for="nav-toggle" class="hamburger" aria-label="Abrir menú"><span></span><span></span><span></span></label><nav class="nav">
            <a href="index.html">Inicio</a>
            <a href="productos.html">Productos</a>
            <a href="carrito.html"><i class="fa-solid fa-cart-shopping"></i> Carrito</a>
        </nav></div></div>
    </header>

    <main class="container page-products">
        <section class="products-head">
            <h1 class="page-title">Categorías</h1>
            <form class="searchbar" action="#" method="get">
                <input type="text" placeholder="Buscar productos..." aria-label="Buscar productos" />
                <button class="search-btn" type="submit" aria-label="Buscar">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </form>
        </section>

        <!-- Dentro de la sección de categorías -->
        <section class="categories categories--strip">
            <div class="categories-grid">
                <a class="category" href="almohadas.html">
                    <img src="img/almohadas.JPG" alt="Almohadas" />
                    <span class="label-strip">Almohadas</span>
                </a>
                <a class="category" href="sabanas.html">
                    <img src="img/sabana.JPG" alt="Sábanas" />
                    <span class="label-strip">Sábanas</span>
                </a>
                <a class="category" href="toallas.html">
                    <img src="img/toallas.JPG" alt="Toallas" />
                    <span class="label-strip">Toallas</span>
                </a>
                <!-- NUEVO: Protectores -->
                <a class="category" href="protectores.html">
                    <img src="img/protector.JPG" alt="Protectores" />
                    <span class="label-strip">Protectores</span>
                </a>
                <!-- Fin nuevo -->
                <a class="category" href="quilt.html">
                    <img src="img/quilt.JPG" alt="Quilt" />
                    <span class="label-strip">Quilt</span>
                </a>
                <a class="category" href="plumones.html">
                    <img src="img/cobertor.JPG" alt="Plumones" />
                    <span class="label-strip">Plumones</span>
                </a>
                <!-- NUEVO: Frazadas -->
                <a class="category" href="frazadas.html">
                    <img src="img/frazada.JPG" alt="Frazadas" />
                    <span class="label-strip">Frazadas</span>
                </a>
                <!-- Fin nuevo -->
                <a class="category" href="infantil.html">
                    <img src="img/infantil.JPG" alt="Infantil" />
                    <span class="label-strip">Infantil</span>
                </a>
            </div>
        </section>

        <hr class="section-divider" />

        <section class="measures">
            <h2 class="page-title">Medidas</h2>

            <div class="measure-list">
                <a class="measure-card" href="medida-1-plaza.html">
                    <img src="img/inicio.jpg" alt="1 Plaza" />
                    <span>1 Plaza</span>
                </a>
                <a class="measure-card" href="medida-1-5-plaza.html">
                    <img src="img/inicio.jpg" alt="1 1/2 Plaza" />
                    <span>1 1/2 Plaza</span>
                </a>
                <a class="measure-card" href="medida-2-plazas.html">
                    <img src="img/inicio.jpg" alt="2 Plazas" />
                    <span>2 Plazas</span>
                </a>
                <a class="measure-card" href="medida-king.html">
                    <img src="img/inicio.jpg" alt="King" />
                    <span>King</span>
                </a>
                <a class="measure-card" href="medida-super-king.html">
                    <img src="img/inicio.jpg" alt="Super King" />
                    <span>Super King</span>
                </a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container footer-grid">
            <div class="contact">
                <h4>Contáctanos</h4>
                <p><i class="fa-brands fa-whatsapp"></i> +56959288588</p>
                <p>Vicente Reyes 773</p>
            </div>
            <div class="social">
                <h4>Social</h4>
                <div class="icons">
                    <a href="https://www.facebook.com/profile.php?id=100023850053500" aria-label="Facebook" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-facebook-square"></i>
                    </a>
                    <a href="https://www.instagram.com/micama_villarrica/" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                        <i class="fa-brands fa-instagram"></i>
                    </a>
                </div>
            </div>
            <div class="copy">
                <p>Copyright © 2025 Diseñado por Maria Fernanda Freelancer</p>
            </div>
        </div>
    </footer>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="cart.js"></script>
<script src="inventory.js"></script>
<script>
(function(){
  var bar = document.querySelector('.searchbar');
  if (!bar) return;
  var input = bar.querySelector('input');
  var btn = bar.querySelector('.search-btn');
  function slugify(s){
    var str = String(s||'').toLowerCase();
    try { str = str.normalize('NFD').replace(/[\u0300-\u036f]/g,''); } catch(e) {}
    return str.replace(/[^a-z0-9]+/g,'').trim();
  }
  function measureAlias(s){
    var raw = String(s||'').toLowerCase();
    var hasPlaza = /plaz(a|as)?/.test(raw);
    if (/super\s*king/.test(raw)) return 'm-superking';
    if (/\bking\b/.test(raw)) return 'm-king';
    if (hasPlaza && (/plaz(a|as)?\s*y\s*media/.test(raw) || /1\s*(?:1\/2|½)\s*plaz(a|as)?/.test(raw) || /\b1\.5\b/.test(raw))) return 'm-15';
    if (hasPlaza && /2\s*plaz(a|as)?/.test(raw)) return 'm-2';
    if (hasPlaza && /1\s*plaz(a|as)?/.test(raw)) return 'm-1';
    return '';
  }
  function resolve(text){
    var m = measureAlias(text);
    if (m==='m-1') return 'medida-1-plaza.html';
    if (m==='m-15') return 'medida-1-5-plaza.html';
    if (m==='m-2') return 'medida-2-plazas.html';
    if (m==='m-king') return 'medida-king.html';
    if (m==='m-superking') return 'medida-super-king.html';
    var t = slugify(text);
    var allowed = ['almohadas','sabanas','toallas','quilt','plumones','infantil','frazadas','protectores'];
    var syn = {
      protectores:['protector','colchon','colchonera','cubrecolchon','cubrecolch','cubre','cubrematelas','cubrecolchoneta'],
      sabanas:['sabana','sabanas'],
      quilt:['quilt','cobertor','acolchado','cubrelecho','cubrecama'],
      plumones:['plumon','edredon','duvet'],
      almohadas:['almohada','cojin','cojines'],
      toallas:['toalla','toallas'],
      frazadas:['frazada','manta','mantas','polar'],
      infantil:['infantil','nina','nino','bebe','baby','juvenil','kids']
    };
    for (var i=0;i<allowed.length;i++){
      var slug = allowed[i];
      if (t.indexOf(slug) >= 0) return slug + '.html';
      var keys = syn[slug] || [];
      for (var j=0;j<keys.length;j++){
        if (t.indexOf(keys[j]) >= 0) return slug + '.html';
      }
    }
    return '';
  }
  function go(e){
    if (e && e.preventDefault) e.preventDefault();
    var val = input && input.value;
    var target = resolve(val);
    if (!target && typeof resolveSearchTarget === 'function') target = resolveSearchTarget(val);
    if (target) { location.href = target; return; }
    (async function(){
      var host = document.querySelector('.products-head') || document.querySelector('main') || document.body;
      var grid = document.getElementById('search-results');
      if (!grid) {
        grid = document.createElement('section');
        grid.id = 'search-results';
        grid.className = 'product-grid';
        host.parentNode.insertBefore(grid, host.nextSibling);
      }
      grid.innerHTML = '<article class="product-card"><h3>Buscando...</h3></article>';
      try {
        var raw = (typeof fetchInventory === 'function') ? await fetchInventory(null) : [];
        var items = Array.isArray(raw) ? raw.map(function(x){ return (typeof normalizeItem === 'function') ? normalizeItem(x) : x; }) : [];
        var q = slugify(val);
        var results = items.filter(function(it){
          var cat = slugify(it && (it.categoria || it.category));
          var name = slugify(it && (it.nombre || it.name));
          var tags = Array.isArray(it && it.tags) ? it.tags.map(slugify).join('') : '';
          return cat.indexOf(q) >= 0 || name.indexOf(q) >= 0 || tags.indexOf(q) >= 0;
        });
        if (!results.length) {
          grid.innerHTML = '<article class="product-card"><h3>No hay resultados</h3><p>Intenta con otra palabra clave.</p></article>';
          return;
        }
        if (typeof renderCard === 'function') {
          grid.innerHTML = results.map(renderCard).join('');
        } else {
          grid.innerHTML = results.map(function(it){
            var esc = function(s){ return String(s||'').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); };
            return '<article class="product-card"><h3>'+esc(it.name||it.nombre)+'</h3></article>';
          }).join('');
        }
      } catch(err) {
        grid.innerHTML = '<article class="product-card"><h3>Error en búsqueda</h3><p>'+String(err&&err.message||err)+'</p></article>';
      }
    })();
  }
  if (btn) btn.addEventListener('click', go);
  if (bar) bar.addEventListener('submit', go);
  if (input) input.addEventListener('keydown', function(e){ if (e.key==='Enter') go(e); });
})();
</script>
</body>
</html>